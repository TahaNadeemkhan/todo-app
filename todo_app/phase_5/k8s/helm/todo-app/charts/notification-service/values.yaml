# T142: Helm Values for Notification Service

replicaCount: 2

image:
  repository: notification-service
  pullPolicy: IfNotPresent
  tag: "1.0.0"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations:
  dapr.io/enabled: "true"
  dapr.io/app-id: "notification-service"
  dapr.io/app-port: "8002"
  dapr.io/log-level: "info"
  dapr.io/enable-metrics: "true"
  dapr.io/metrics-port: "9090"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false  # Firebase needs to write temp files
  allowPrivilegeEscalation: false

service:
  type: ClusterIP
  port: 80
  targetPort: 8002

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: notification-service.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 200m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - notification-service
          topologyKey: kubernetes.io/hostname

# Application-specific configuration
env:
  - name: ENVIRONMENT
    value: "production"
  - name: SERVICE_PORT
    value: "8002"
  - name: LOG_LEVEL
    value: "INFO"

  # Database
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: notification-db-secret
        key: DATABASE_URL

  # Email - Brevo API
  - name: BREVO_API_KEY
    valueFrom:
      secretKeyRef:
        name: notification-email-secret
        key: BREVO_API_KEY
        optional: true

  # Email - SMTP Fallback
  - name: SMTP_HOST
    value: "smtp-relay.brevo.com"
  - name: SMTP_PORT
    value: "587"
  - name: SMTP_USERNAME
    valueFrom:
      secretKeyRef:
        name: notification-email-secret
        key: SMTP_USERNAME
        optional: true
  - name: SMTP_PASSWORD
    valueFrom:
      secretKeyRef:
        name: notification-email-secret
        key: SMTP_PASSWORD
        optional: true
  - name: SMTP_FROM_EMAIL
    value: "noreply@itasks.app"
  - name: SMTP_FROM_NAME
    value: "iTasks Reminders"

  # Firebase Cloud Messaging
  - name: FCM_CREDENTIALS_JSON
    valueFrom:
      secretKeyRef:
        name: notification-fcm-secret
        key: FCM_CREDENTIALS_JSON
        optional: true
  - name: FCM_PROJECT_ID
    valueFrom:
      secretKeyRef:
        name: notification-fcm-secret
        key: FCM_PROJECT_ID
        optional: true

  # Dapr Configuration
  - name: DAPR_HTTP_PORT
    value: "3500"
  - name: DAPR_GRPC_PORT
    value: "50001"
  - name: DAPR_APP_ID
    value: "notification-service"
  - name: DAPR_PUBSUB_NAME
    value: "pubsub-kafka"
  - name: DAPR_REMINDERS_TOPIC
    value: "reminders"
  - name: DAPR_NOTIFICATIONS_TOPIC
    value: "notifications"

  # Retry Policy
  - name: MAX_RETRY_ATTEMPTS
    value: "3"
  - name: RETRY_BACKOFF_BASE
    value: "2.0"
  - name: RETRY_BACKOFF_MAX
    value: "300"

# Health check configuration
livenessProbe:
  httpGet:
    path: /health
    port: 8002
  initialDelaySeconds: 15
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 8002
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

# Prometheus monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    path: /metrics

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
