# Dapr Subscription for Recurring Task Service
# Based on Hackathon II Document - Phase V Requirements
# Subscribes to the 'task-events' Kafka topic and routes task completion events
apiVersion: dapr.io/v1alpha1
kind: Subscription
metadata:
  name: task-events-subscription
  namespace: default
spec:
  # Kafka topic to subscribe to
  topic: task-events

  # Route incoming events to this HTTP endpoint on the recurring-task-service
  route: /events/task-completed

  # Pub/Sub component name (matches pubsub-kafka.yaml)
  pubsubname: kafka-pubsub

  # Metadata for subscription configuration
  metadata:
    # Consumer group ID (ensures only one consumer in group processes each message)
    - name: consumerID
      value: "recurring-task-service"

    # Max number of concurrent messages to process
    - name: maxConcurrentHandlers
      value: "5"

    # Dead letter topic for failed messages (after max retries)
    - name: deadLetterTopic
      value: "task-events-dlq"

# Route configuration for the recurring task service
scopes:
  - recurring-task-service
