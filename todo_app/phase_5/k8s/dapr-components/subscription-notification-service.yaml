# Dapr Subscription for Notification Service
# Based on Hackathon II Document - Phase V Requirements
# Subscribes to the 'reminders' Kafka topic and routes to notification service endpoint
apiVersion: dapr.io/v1alpha1
kind: Subscription
metadata:
  name: reminders-subscription
  namespace: default
spec:
  # Kafka topic to subscribe to
  topic: reminders

  # Route incoming events to this HTTP endpoint on the notification-service
  route: /events/reminders

  # Pub/Sub component name (matches pubsub-kafka.yaml)
  pubsubname: kafka-pubsub

  # Metadata for subscription configuration
  metadata:
    # Consumer group ID (ensures only one consumer in group processes each message)
    - name: consumerID
      value: "notification-service"

    # Max number of concurrent messages to process
    - name: maxConcurrentHandlers
      value: "10"

    # Dead letter topic for failed messages (after max retries)
    - name: deadLetterTopic
      value: "reminders-dlq"

# Route configuration for the notification service
scopes:
  - notification-service
